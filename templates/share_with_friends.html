<!-- step 3 -->

<div id="steps-header">
	<ul class="inline-links form-steps">
		<li id="learn-more">
			<img src="{{PATH}}images/webcam_one.png"/>
		</li><li class="back-line">
		</li><li id="get-involved">
			<img src="{{PATH}}images/pen_two.png"/>			
		</li><li class="back-line">
		</li><li class="active" id="join-us">
			<a class="info" onclick="$j('#modal-overlay').css('visibility','visible')">Directions</a>
			<img src="{{PATH}}images/share_three.png"/>
		</li>
	</ul>
	
	<div class="center50">
		<p class="error-message">{{ERROR_MESSAGE}}</p>
		{{FORM}}
		<div id="social-icons-holder">
			<h4>Contact Method</h4>
			<ul class="inline-links social-icons">
				<li>
					<span>facebook</span>
					<img class="gray" src="{{PATH}}images/facebook.png"/>
				</li>
				<li id="get-involved">
					<span>twitter</span>
					<img class="gray" src="{{PATH}}images/twitter.png"/>
				</li>
				<li class="active" id="join-us">
					<span>email</span>
					<img src="{{PATH}}images/email.png" onclick="$j('.modal-input-overlay').toggleClass('inactive');" />

				</li>
			</ul>
		</div>
	</div>
	
</div>

<div id="watch-area">
</div>

<div id="quote-area">
</div>

<div id="main-area">
	<div id="share-email-preview">
		
	</div>

</div>

<div id="modal-overlay">
	<div id="modal-directions">
		<img id="close-button" src="{{PATH}}images/close_button.png" onclick="$j('#modal-overlay').css('visibility','hidden');" />
		<h1>How to Spread the Word</h1>
		<ul class="inline-links form-steps">
			<li>
				<img src="{{PATH}}images/webcam_one.png"/>
				<h4>Create a video</h4>
			</li>
			<li>
				<img src="{{PATH}}images/pen_two.png"/>
				<h4>Write a message</h4>
			</li>
			<li class="active">
				<img src="{{PATH}}images/share_three.png"/>
				<h4>Share</h4>
			</li>
		</ul>
		
		<p class="error-message">{{ERROR_MESSAGE}}</p>

		<div id="directions-box">
			<h2>Directions</h2>
			<img id="directions-marker" src="{{PATH}}images/share_three_35.png"/>
			<div id="directions">
				<p>You can send your friends a message to view your video. A basic message has been added for you, but you can edit it. This message will not be visible publicly.</p>
				<p class="gray">If you need some help writing your message, you can have an automatic message added to your video.</p>
			</div>
			<img src="{{PATH}}images/multifriend.png" />
		</div>
		<button id="close-button-bottom" class="tf-button" onclick="$j('#modal-overlay').css('visibility','hidden');">Share with Friends</button>
	</div>
</div>

<div id="social-message" class="auto-replace" style="display: none">Hey {{FRIEND}},

Checkout the video I made for you and the links below as I think you'd be interested in Open Source Ecology.
{{EMAIL_VIDEO_LINK}}
</div>

<div id="fb-root"></div>
<div id="TDFriendSelector">
	<div class="TDFriendSelector_dialog">
		<a href="#" id="TDFriendSelector_buttonClose">x</a>
		<div class="TDFriendSelector_form">
			<div class="TDFriendSelector_header">
				<p>Select your friends</p>
			</div>
			<div class="TDFriendSelector_content">
				<p>Then you can invite them to join you in the app.</p>
				<div class="TDFriendSelector_searchContainer TDFriendSelector_clearfix">
					<div class="TDFriendSelector_selectedCountContainer"><span class="TDFriendSelector_selectedCount">0</span> / <span class="TDFriendSelector_selectedCountMax">0</span> friends selected</div>
					<input type="text" placeholder="Search friends" id="TDFriendSelector_searchField" />
				</div>
				<div class="TDFriendSelector_friendsContainer"></div>
			</div>
			<div class="TDFriendSelector_footer TDFriendSelector_clearfix">
				<a href="#" id="TDFriendSelector_pagePrev" class="TDFriendSelector_disabled">Previous</a>
				<a href="#" id="TDFriendSelector_pageNext">Next</a>
				<div class="TDFriendSelector_pageNumberContainer">
					Page <span id="TDFriendSelector_pageNumber">1</span> / <span id="TDFriendSelector_pageNumberTotal">1</span>
				</div>
				<a href="#" id="TDFriendSelector_buttonOK">OK</a>
			</div>
		</div>
	</div>
</div>

<button id="selectFriends" type="button">Select Friends For Robot Message</button>
<button id="revokeAuth" type="button" onclick="uninstallApp()">Revoke/Uninstall</button>


<script>
	// These two json objects take content from first selector and put it in second; see dynamic.js
	var autoReplaceArray = {
		"#social-icons-holder":"#mw-form-section-social-buttons"
	}
	var autoInputArray = {
		"#social-message":"#ose-truefan-friends-message"
	}
	
	$j(document).ready(function() {
		var emailWrap =	'<div class="modal-input-overlay inactive">'+
									'<div id="email-list-modal" class="modal-input">'+
										'<div id="email-input-container"></div>'+
									'</div>'+
								'</div>';
		var emailHelpMessage = '<h3>Enter Email Addresses</h3>';
		var emailButton = '<br/><input id="email-list-ok" type="button" value="Ok" />';
	
		$j('.mw-htmlform-field-HTMLTextArray').html(
				'<div class="email-list-combo">'+
					'<div class="email-input-cluster">'+
						'<div class="mw-label">'+
							'<label>Name</label>'+
						'</div>'+
						'<div class="mw-input">'+
							'<input class="email-names" type="text" />'+
						'</div>'+
					'</div>'+
					'<div class="email-input-cluster">'+
						'<div class="mw-label">'+
							'<label for="ose-truefan-email-input">Email</label>'+
						'</div>'+
						'<div class="mw-input">'+
							'<input class="email-addresses" type="text" name="wpEmailInput[]"/>'+
						'</div>'+
					'</div>'+
				'</div>');
		$j('.email-addresses').keyup(addEmailInput);
		$j('#mw-form-section-email .mw-htmlform-field-HTMLTextArray').children().wrapAll(emailWrap);
		$j('#email-list-modal').prepend(emailHelpMessage);
		$j('#email-list-modal').append(emailButton);
		$j('#email-list-ok').click(processEmail);

		
		function processEmail()
		{
			var addresses = new Array();
			// TODO: Remove empty email inputs
			$j('.modal-input-overlay').addClass('inactive');
			$j('#share-email-preview').empty('');
			$j('#email-input-container .email-list-combo').each( function(index) {
				var name = $j(this).find('.email-names').val();
				var address = $j(this).find('.email-addresses').val();
				if(address != '') {
					addresses.push(name + ':<' + address + '>');
				}
			});
			$j('input[name=wpEmailList]').val(addresses.join(','));
		
			if(addresses.length > 0) {
				$j('#share-email-preview').append('<h3>Email List</h3>');
				for(var i=0; i<addresses.length; i++) {
					addresses[i] = addresses[i].replace('<','&lt');
					addresses[i] = addresses[i].replace('>','&gt');
					addresses[i] = addresses[i].replace(':',' ');
					$j('#share-email-preview').append('<div class="email-preview-item"><img src="/w/extensions/ShareOSE/images/email_sm.png" /><div class="preview-address">'+addresses[i]+'</div></div>');
				}
			}
		}
		
		function addEmailInput(e)
		{
			// Any input that contains value creates a single new input, and pays the process forward
			if(this.value != '') {
				$j(this).unbind('keyup');
				// FIXME: for tags are incorrect
				$j('#email-input-container').append(
						'<div class="email-list-combo">'+
							'<div class="email-input-cluster">'+
								'<div class="mw-label">'+
									'<label>Name</label>'+
								'</div>'+
								'<div class="mw-input">'+
									'<input class="email-names" type="text" />'+
								'</div>'+
							'</div>'+
							'<div class="email-input-cluster">'+
								'<div class="mw-label">'+
									'<label for="ose-truefan-email-input">Email</label>'+
								'</div>'+
								'<div class="mw-input">'+
									'<input class="email-addresses" type="text" name="wpEmailInput[]"/>'+
								'</div>'+
							'</div>'+
						'</div>');
				$j('#trueFanForm .email-input-cluster input:last').keyup(addEmailInput);
			}
		}
	});
</script>

